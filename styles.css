:root{
  --top:56px; --dock:92px; --safe:env(safe-area-inset-bottom,0px);
  --bg:#f4f6fb; --panel:#ffffff; --card:#ffffff; --line:#d5dceb; --ink:#1b2440;
  --accent:#2d6aff; --ok:#1aa255; --warn:#d9822b; --danger:#d93025;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;overflow:hidden}

/* Top */
.topbar{
  position:fixed;top:0;left:0;right:0;height:var(--top);
  display:flex;align-items:center;gap:8px;padding:0 10px;
  background:#ffffffd9;border-bottom:1px solid var(--line);
  backdrop-filter:blur(8px);
  z-index:100000; pointer-events:auto; touch-action:manipulation;
}
.brand{font-weight:700;padding:6px 10px;border:1px solid var(--line);border-radius:10px;background:var(--card)}
.chips{display:flex;gap:6px;margin-left:auto;margin-right:8px}
.chip{height:34px;padding:0 12px;border-radius:999px;border:1px solid var(--line);background:var(--card);color:var(--ink);font-weight:600;touch-action:manipulation}
.chip.active{border-color:var(--accent);box-shadow:0 0 0 2px #2d6aff22 inset}
.status{display:flex;gap:6px;align-items:center;font-size:12px;opacity:.95}
.badge{display:inline-flex;align-items:center;justify-content:center;min-width:22px;height:22px;border-radius:999px;background:#eef2ff;color:#1b2440;border:1px solid var(--line);font-weight:700}

/* Map */
.stage{margin-top:var(--top)}
.map{width:100%;height:calc(100dvh - var(--top) - (var(--dock) + var(--safe)));background:#e8eefc}
.leaflet-bottom{bottom:calc(var(--dock) + var(--safe))}
.errors{
  position:fixed;left:8px;right:8px;top:calc(var(--top) + 8px);max-height:24dvh;overflow:auto;
  padding:8px;background:#fff4f2;border:1px solid #f2c1b8;color:#6b1d13;border-radius:8px;z-index:100001;font-size:12px
}
.hidden{display:none}

/* Dock fixe (au-dessus de la carte) */
.dock{
  position:fixed;left:0;right:0;bottom:0;height:calc(var(--dock) + var(--safe));
  padding:10px 10px calc(10px + var(--safe));
  background:#ffffffd9;border-top:1px solid var(--line);
  display:grid;grid-template-columns:repeat(4,1fr);gap:10px;
  z-index:100000; pointer-events:auto; backdrop-filter:blur(8px); touch-action:manipulation;
}
.dock-btn{
  height:64px;border-radius:12px;border:1px solid var(--line);
  background:var(--card);color:var(--ink);
  font-weight:800;font-size:14px; touch-action:manipulation; cursor:pointer;
}
.dock-btn[aria-pressed="true"]{border-color:var(--accent);box-shadow:0 0 0 2px #2d6aff22 inset}

/* Leaflet panes sous l’UI */
.leaflet-pane, .leaflet-top, .leaflet-bottom { z-index: 500 !important; }
.acc-info{
  background:#ffffffd9;color:#1b2440;border:1px solid var(--line);
  padding:6px 8px;border-radius:8px;font-size:12px;line-height:1.2;backdrop-filter:blur(8px)
}
.maxpair-label{
  color:#1b2440;background:#ffffffd9;padding:2px 6px;border-radius:6px;border:1px solid var(--line);font-weight:700
}

/* Indicateur d'état (clair) */
.status-box{
  padding:6px 10px; border-radius:8px; font-weight:700; display:inline-block;
  border:1px solid var(--line); background:#ffffffd9; backdrop-filter:blur(8px);
  font-size:12px;
}
.status-ok{ background:#e6ffe6; color:#0a7a2a; border-color:#bfe8c5; }
.status-warning{ background:#fff8e6; color:#a06600; border-color:#f0db9e; }
.status-error{ background:#ffe6e6; color:#b30000; border-color:#f2b3b3; }

/* Priorité d'interactions pour topbar/dock */
.topbar, .dock, .topbar * , .dock * { pointer-events:auto; }
.leaflet-container { pointer-events:auto; touch-action:pan-x pan-y; }